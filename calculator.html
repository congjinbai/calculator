<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2575.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!doctype html&gt;</p>
<p class="p1">&lt;html lang="zh"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1">&lt;meta charset="utf-8"/&gt;</p>
<p class="p1">&lt;meta name="viewport" content="width=device-width,initial-scale=1"/&gt;</p>
<p class="p1">&lt;title&gt;兑换计算器&lt;/title&gt;</p>
<p class="p1">&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>:root{</p>
<p class="p1"><span class="Apple-converted-space">    </span>--bg1:#efeae3;</p>
<p class="p1"><span class="Apple-converted-space">    </span>--card:#ffffff;</p>
<p class="p1"><span class="Apple-converted-space">    </span>--muted:#6b6f74;</p>
<p class="p1"><span class="Apple-converted-space">    </span>--accent:#b88646;</p>
<p class="p1"><span class="Apple-converted-space">    </span>--accent-strong:#9a6f3a;</p>
<p class="p1"><span class="Apple-converted-space">    </span>--shadow: 0 8px 30px rgba(19,18,17,0.08);</p>
<p class="p1"><span class="Apple-converted-space">    </span>--green:#2f8f6e;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>*{box-sizing:border-box}</p>
<p class="p1"><span class="Apple-converted-space">  </span>html,body{height:100%}</p>
<p class="p1"><span class="Apple-converted-space">  </span>body{</p>
<p class="p1"><span class="Apple-converted-space">    </span>margin:0; font-family: Inter, "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: linear-gradient(180deg,var(--bg1), #f6f3ee);</p>
<p class="p1"><span class="Apple-converted-space">    </span>-webkit-font-smoothing:antialiased; color:#1b1b1b;</p>
<p class="p1"><span class="Apple-converted-space">    </span>display:flex; align-items:center; justify-content:center; padding:36px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>min-height:100vh;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>.wrap{width:100%;max-width:980px;display:flex;gap:28px;align-items:center;justify-content:center}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.card{</p>
<p class="p1"><span class="Apple-converted-space">    </span>background:var(--card); border-radius:14px; padding:26px; box-shadow:var(--shadow); width:720px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>transition:transform .18s ease, box-shadow .18s ease;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.card:hover{transform:translateY(-4px)}</p>
<p class="p1"><span class="Apple-converted-space">  </span>header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:6px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.title-block{flex:1}</p>
<p class="p1"><span class="Apple-converted-space">  </span>h1{margin:0;font-size:20px;letter-spacing:0.2px;font-weight:600;color:#222}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.lang-row{display:flex;align-items:center;gap:8px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.flag-btn{border:0;background:transparent;padding:6px;border-radius:8px;font-size:14px;cursor:pointer;transition:transform .15s, box-shadow .15s}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.flag-btn:hover{transform:translateY(-3px); box-shadow:0 6px 18px rgba(154,111,58,0.12)}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.flag-btn.active{box-shadow:inset 0 -2px 0 rgba(154,111,58,0.12); border-radius:8px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.controls{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:12px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #e6e2dc;background:transparent;font-size:15px;color:#111}</p>
<p class="p1"><span class="Apple-converted-space">  </span>input:focus{outline:none;box-shadow:0 6px 18px rgba(154,111,58,0.08);border-color:rgba(154,111,58,0.18)}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.full{grid-column:1 / -1}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.direction{display:flex;gap:8px;align-items:center}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.pill{padding:8px 12px;border-radius:999px;border:1px solid #eee;background:linear-gradient(180deg,#fff,#fbfaf8);cursor:pointer;font-weight:600;color:#333}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.pill.active{background:linear-gradient(180deg,#fff8f1,#fff2e6);border:1px solid rgba(154,111,58,0.18);box-shadow:0 6px 18px rgba(154,111,58,0.06)}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.result-card{margin-top:18px;background:linear-gradient(180deg,#fff,#fff);border-radius:12px;padding:16px;border:1px solid #f0ebe6}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.row{display:flex;justify-content:space-between;align-items:center;padding:10px 4px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.label{color:var(--muted);font-size:13px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.value{font-size:18px;font-weight:700;color:#111}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.value.editable{cursor:text;padding:6px 10px;border-radius:8px;min-width:140px;text-align:right}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.value.editable:focus{outline:none;box-shadow:0 6px 18px rgba(154,111,58,0.06)}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.small{font-size:12px;color:var(--muted);margin-top:6px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.note{font-size:12px;color:var(--muted);margin-top:8px; white-space:pre-line}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.muted-block{font-size:13px;color:var(--muted);margin-top:8px}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.right-col{flex:1}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.hint{font-size:12px;color:#8b8f94}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.footer{margin-top:14px;font-size:12px;color:var(--muted);text-align:center;display:none}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Новые стили для input полей */</p>
<p class="p1"><span class="Apple-converted-space">  </span>.input-wrapper {</p>
<p class="p1"><span class="Apple-converted-space">    </span>position: relative;</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.input-wrapper input {</p>
<p class="p1"><span class="Apple-converted-space">    </span>width: 100%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding: 10px 40px 10px 12px; /* Добавили отступ справа для символа */</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-radius: 10px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>border: 1px solid #e6e2dc;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: transparent;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 18px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: #111;</p>
<p class="p1"><span class="Apple-converted-space">    </span>text-align: right;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.input-wrapper input:focus {</p>
<p class="p1"><span class="Apple-converted-space">    </span>outline: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>box-shadow: 0 6px 18px rgba(154,111,58,0.08);</p>
<p class="p1"><span class="Apple-converted-space">    </span>border-color: rgba(154,111,58,0.18);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>.currency-symbol {</p>
<p class="p1"><span class="Apple-converted-space">    </span>position: absolute;</p>
<p class="p1"><span class="Apple-converted-space">    </span>right: 12px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>top: 50%;</p>
<p class="p1"><span class="Apple-converted-space">    </span>transform: translateY(-50%);</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-size: 18px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>font-weight: 700;</p>
<p class="p1"><span class="Apple-converted-space">    </span>color: #111;</p>
<p class="p1"><span class="Apple-converted-space">    </span>pointer-events: none;</p>
<p class="p1"><span class="Apple-converted-space">    </span>background: white;</p>
<p class="p1"><span class="Apple-converted-space">    </span>padding-left: 4px;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>/* responsive */</p>
<p class="p1"><span class="Apple-converted-space">  </span>@media (max-width:860px){</p>
<p class="p1"><span class="Apple-converted-space">    </span>.wrap{flex-direction:column;align-items:stretch}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.card{width:100%}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.controls{grid-template-columns:1fr}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>/* Добавленные стили для мобильных устройств */</p>
<p class="p1"><span class="Apple-converted-space">  </span>@media (max-width: 600px) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>.input-wrapper input {</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size: 16px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 8px 36px 8px 10px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.currency-symbol {</p>
<p class="p1"><span class="Apple-converted-space">      </span>font-size: 16px;</p>
<p class="p1"><span class="Apple-converted-space">      </span>right: 10px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>body {</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 20px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>.card {</p>
<p class="p1"><span class="Apple-converted-space">      </span>padding: 20px;</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;div class="wrap"&gt;</p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;div class="card" role="application" aria-label="Currency calculator"&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;header&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="title-block"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;h1 id="title"&gt;兑换计算器&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/header&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="controls" style="margin-top:6px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- направление (полная ширина) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="full"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label id="lbl-direction"&gt;方向&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div class="direction" role="radiogroup" aria-labelledby="lbl-direction"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button class="pill active" id="dir-rub2cny" data-dir="rub2cny" aria-pressed="true"&gt;₽ ⇒ ¥&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;button class="pill" id="dir-cny2rub" data-dir="cny2rub" aria-pressed="false"&gt;¥ ⇒ ₽&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;!-- Ваш курс и Клиентский курс — на одной строке --&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label id="lbl-your-rate"&gt;今日汇率&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;input id="myRate" inputmode="decimal" placeholder="" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;label id="lbl-client-rate"&gt;客户汇率&lt;/label&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;input id="clientRate" inputmode="decimal" placeholder="" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;div class="result-card" id="results"&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="row" style="align-items:flex-start"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;!-- слева — Клиент отдаст (editable) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="label" id="lab-client-give-label"&gt;客户给我&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="input-wrapper"&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;input type="text" id="clientGive" inputmode="decimal" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;span class="currency-symbol" id="giveCurrency"&gt;₽&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;!-- справа — Клиент получит (editable) --&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div style="text-align:right"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="label" id="lab-client-get"&gt;我给客户&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="input-wrapper"&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;input type="text" id="clientGet" inputmode="decimal" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">              </span>&lt;span class="currency-symbol" id="getCurrency"&gt;¥&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="row" style="border-top:1px dashed #f0ebe6;margin-top:8px;padding-top:12px"&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="label" id="lab-profit-rub"&gt;您的利润 (₽)&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="value" id="profitRub"&gt;—&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;div style="text-align:right"&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="label" id="lab-profit-cny"&gt;您的利润 (¥)&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">            </span>&lt;div class="value" id="profitCny"&gt;—&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">          </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">        </span>&lt;div class="note" id="detailLine"&gt;—&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">      </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1">&lt;script&gt;</p>
<p class="p1">/* ====== Утилиты ====== */</p>
<p class="p1">function cleanNum(s){</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (s === null || s === undefined) return NaN;</p>
<p class="p1"><span class="Apple-converted-space">  </span>s = String(s).trim();</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (s === "") return NaN;</p>
<p class="p1"><span class="Apple-converted-space">  </span>s = s.replace(/\s+/g,'').replace(/,/g,'.').replace(/[^\d.\-]/g,'');</p>
<p class="p1"><span class="Apple-converted-space">  </span>const n = Number(s);</p>
<p class="p1"><span class="Apple-converted-space">  </span>return isFinite(n) ? n : NaN;</p>
<p class="p1">}</p>
<p class="p1">function fmt(n, dec=2, forceDecimals=false){</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (!isFinite(n)) return '—';</p>
<p class="p1"><span class="Apple-converted-space">  </span>// Для направления ¥⇒₽ и целых чисел не показываем .00</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (direction === 'cny2rub' &amp;&amp; dec === 2 &amp;&amp; Number.isInteger(n) &amp;&amp; !forceDecimals) {</p>
<p class="p1"><span class="Apple-converted-space">    </span>return n.toLocaleString(undefined, {maximumFractionDigits: 0});</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>return n.toLocaleString(undefined, {</p>
<p class="p1"><span class="Apple-converted-space">    </span>minimumFractionDigits: forceDecimals ? dec : 0,</p>
<p class="p1"><span class="Apple-converted-space">    </span>maximumFractionDigits: dec</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1">}</p>
<p class="p1">function escHTML(str){</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (str === null || str === undefined) return '';</p>
<p class="p1"><span class="Apple-converted-space">  </span>return String(str).replace(/[&amp;&lt;&gt;"']/g, s=&gt; ({'&amp;':'&amp;amp;','&lt;':'&amp;lt;','&gt;':'&amp;gt;','"':'&amp;quot;',"'":'&amp;#39;'}[s]));</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/* ====== Элементы ====== */</p>
<p class="p1">const el = id =&gt; document.getElementById(id);</p>
<p class="p1">const myRateEl = el('myRate');</p>
<p class="p1">const clientRateEl = el('clientRate');</p>
<p class="p1">const dirRubBtn = el('dir-rub2cny');</p>
<p class="p1">const dirCnyBtn = el('dir-cny2rub');</p>
<p class="p1">const clientGetEl = el('clientGet');</p>
<p class="p1">const clientGiveEl = el('clientGive');</p>
<p class="p1">const profitRubEl = el('profitRub');</p>
<p class="p1">const profitCnyEl = el('profitCny');</p>
<p class="p1">const detailLine = el('detailLine');</p>
<p class="p1">const titleEl = el('title');</p>
<p class="p1">const labClientGet = el('lab-client-get');</p>
<p class="p1">const labClientGive = el('lab-client-give-label');</p>
<p class="p1">const labDirection = el('lbl-direction');</p>
<p class="p1">const labYourRate = el('lbl-your-rate');</p>
<p class="p1">const labClientRate = el('lbl-client-rate');</p>
<p class="p1">const labProfitRub = el('lab-profit-rub');</p>
<p class="p1">const labProfitCny = el('lab-profit-cny');</p>
<p class="p1">const giveCurrencyEl = el('giveCurrency');</p>
<p class="p1">const getCurrencyEl = el('getCurrency');</p>
<p class="p2"><br></p>
<p class="p1">/* ====== Состояние ====== */</p>
<p class="p1">let direction = 'rub2cny';</p>
<p class="p1">let lastEdited = null; // 'clientGet' | 'clientGive' | 'myRate' | 'clientRate'</p>
<p class="p1">let debounceTimer = null;</p>
<p class="p2"><br></p>
<p class="p1">/* ====== Локализация (минимальная) ====== */</p>
<p class="p1">const L = {</p>
<p class="p1"><span class="Apple-converted-space">  </span>cn: {</p>
<p class="p1"><span class="Apple-converted-space">    </span>title:'兑换计算器',</p>
<p class="p1"><span class="Apple-converted-space">    </span>clientGet:’我给客户’,</p>
<p class="p1"><span class="Apple-converted-space">    </span>clientGive:'客户给我’,</p>
<p class="p1"><span class="Apple-converted-space">    </span>direction: '方向',</p>
<p class="p1"><span class="Apple-converted-space">    </span>yourRate: ‘今日汇率',</p>
<p class="p1"><span class="Apple-converted-space">    </span>clientRate: '客户汇率',</p>
<p class="p1"><span class="Apple-converted-space">    </span>profitRub: '您的利润 (₽)',</p>
<p class="p1"><span class="Apple-converted-space">    </span>profitCny: '您的利润 (¥)'</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">};</p>
<p class="p2"><br></p>
<p class="p1">/* ====== Direction toggles ====== */</p>
<p class="p1">function setDirection(dir){</p>
<p class="p1"><span class="Apple-converted-space">  </span>direction = dir;</p>
<p class="p1"><span class="Apple-converted-space">  </span>dirRubBtn.classList.toggle('active', dir==='rub2cny');</p>
<p class="p1"><span class="Apple-converted-space">  </span>dirCnyBtn.classList.toggle('active', dir==='cny2rub');</p>
<p class="p1"><span class="Apple-converted-space">  </span>dirRubBtn.setAttribute('aria-pressed', dir==='rub2cny');</p>
<p class="p1"><span class="Apple-converted-space">  </span>dirCnyBtn.setAttribute('aria-pressed', dir==='cny2rub');</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>// Обновляем символы валют в зависимости от направления</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (dir === 'rub2cny') {</p>
<p class="p1"><span class="Apple-converted-space">    </span>giveCurrencyEl.textContent = '₽';</p>
<p class="p1"><span class="Apple-converted-space">    </span>getCurrencyEl.textContent = '¥';</p>
<p class="p1"><span class="Apple-converted-space">  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">    </span>giveCurrencyEl.textContent = '¥';</p>
<p class="p1"><span class="Apple-converted-space">    </span>getCurrencyEl.textContent = '₽';</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><span class="Apple-converted-space">  </span></p>
<p class="p1"><span class="Apple-converted-space">  </span>scheduleRecalc('direction');</p>
<p class="p1">}</p>
<p class="p1">dirRubBtn.addEventListener('click', ()=&gt; setDirection('rub2cny'));</p>
<p class="p1">dirCnyBtn.addEventListener('click', ()=&gt; setDirection('cny2rub'));</p>
<p class="p2"><br></p>
<p class="p1">/* ====== Нормализация курса: приводим к руб/¥ ====== */</p>
<p class="p1">function toRubPerCny(rateInput){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const v = cleanNum(rateInput);</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (!isFinite(v) || v === 0) return NaN;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (Math.abs(v) &gt; 1) return v;</p>
<p class="p1"><span class="Apple-converted-space">  </span>return 1 / v;</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/* ====== Главная вычисляющая функция ====== */</p>
<p class="p1">function computeAll(){</p>
<p class="p1"><span class="Apple-converted-space">  </span>const myRateIn = cleanNum(myRateEl.value);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const clientRateIn = cleanNum(clientRateEl.value);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const myRate = toRubPerCny(myRateIn);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const clientRate = toRubPerCny(clientRateIn);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// проверка курсов</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (!isFinite(myRate) || !isFinite(clientRate) || myRate &lt;= 0 || clientRate &lt;= 0){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (lastEdited !== 'clientGive') clientGiveEl.value = '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (lastEdited !== 'clientGet') clientGetEl.value = '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>profitRubEl.textContent = '—';</p>
<p class="p1"><span class="Apple-converted-space">    </span>profitCnyEl.textContent = '—';</p>
<p class="p1"><span class="Apple-converted-space">    </span>detailLine.textContent = '请输入正确的汇率';</p>
<p class="p1"><span class="Apple-converted-space">    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// получаем текущее значения из полей ввода</p>
<p class="p1"><span class="Apple-converted-space">  </span>const rawGive = cleanNum(clientGiveEl.value);</p>
<p class="p1"><span class="Apple-converted-space">  </span>const rawGet<span class="Apple-converted-space">  </span>= cleanNum(clientGetEl.value);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>let amountRub = NaN; // сумма в рублях (если применимо)</p>
<p class="p1"><span class="Apple-converted-space">  </span>let amountCny = NaN; // сумма в юанях (если применимо)</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// если пользователь редактировал clientGive — считаем исходя из него</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (lastEdited === 'clientGive' || (isFinite(rawGive) &amp;&amp; !isFinite(rawGet))){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (isFinite(rawGive)){</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (direction === 'rub2cny'){</p>
<p class="p1"><span class="Apple-converted-space">        </span>amountRub = rawGive;</p>
<p class="p1"><span class="Apple-converted-space">        </span>amountCny = amountRub / clientRate;</p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>amountCny = rawGive;</p>
<p class="p1"><span class="Apple-converted-space">        </span>amountRub = amountCny * clientRate;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>// если пользователь редактировал clientGet — считаем исходя из него</p>
<p class="p1"><span class="Apple-converted-space">  </span>else if (lastEdited === 'clientGet' || (isFinite(rawGet) &amp;&amp; !isFinite(rawGive))){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (isFinite(rawGet)){</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (direction === 'rub2cny'){</p>
<p class="p1"><span class="Apple-converted-space">        </span>amountCny = rawGet;</p>
<p class="p1"><span class="Apple-converted-space">        </span>amountRub = amountCny * clientRate;</p>
<p class="p1"><span class="Apple-converted-space">      </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">        </span>amountRub = rawGet;</p>
<p class="p1"><span class="Apple-converted-space">        </span>amountCny = amountRub / clientRate;</p>
<p class="p1"><span class="Apple-converted-space">      </span>}</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">    </span>// если оба заполнены, приоритет — clientGive (прямое число), иначе попробуем clientGet</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (isFinite(rawGive)){</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (direction === 'rub2cny'){ amountRub = rawGive; amountCny = amountRub / clientRate; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>else { amountCny = rawGive; amountRub = amountCny * clientRate; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>} else if (isFinite(rawGet)){</p>
<p class="p1"><span class="Apple-converted-space">      </span>if (direction === 'rub2cny'){ amountCny = rawGet; amountRub = amountCny * clientRate; }</p>
<p class="p1"><span class="Apple-converted-space">      </span>else { amountRub = rawGet; amountCny = amountRub / clientRate; }</p>
<p class="p1"><span class="Apple-converted-space">    </span>}</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// если не получилось вычислить суммы — очистим поля</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (!isFinite(amountRub) || !isFinite(amountCny)){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (lastEdited !== 'clientGive') clientGiveEl.value = '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (lastEdited !== 'clientGet') clientGetEl.value = '';</p>
<p class="p1"><span class="Apple-converted-space">    </span>profitRubEl.textContent = '—';</p>
<p class="p1"><span class="Apple-converted-space">    </span>profitCnyEl.textContent = '—';</p>
<p class="p1"><span class="Apple-converted-space">    </span>detailLine.textContent = '请输入正确的值';</p>
<p class="p1"><span class="Apple-converted-space">    </span>return;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// вычисляем прибыль</p>
<p class="p1"><span class="Apple-converted-space">  </span>let profitCny, profitRub;</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (direction === 'rub2cny'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>const myCnyBought = amountRub / myRate;</p>
<p class="p1"><span class="Apple-converted-space">    </span>profitCny = myCnyBought - amountCny;</p>
<p class="p1"><span class="Apple-converted-space">    </span>profitRub = profitCny * myRate;</p>
<p class="p1"><span class="Apple-converted-space">  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">    </span>const myRub = amountCny * myRate;</p>
<p class="p1"><span class="Apple-converted-space">    </span>profitRub = myRub - amountRub;</p>
<p class="p1"><span class="Apple-converted-space">    </span>profitCny = profitRub / myRate;</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// отображаем обновлённые значения</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (direction === 'rub2cny'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (lastEdited !== 'clientGive') clientGiveEl.value = fmt(amountRub,0);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (lastEdited !== 'clientGet') clientGetEl.value = fmt(amountCny,2);</p>
<p class="p1"><span class="Apple-converted-space">  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (lastEdited !== 'clientGive') clientGiveEl.value = fmt(amountCny,2);</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (lastEdited !== 'clientGet') clientGetEl.value = fmt(amountRub,2);</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>profitRubEl.textContent = fmt(profitRub,2) + ' ₽';</p>
<p class="p1"><span class="Apple-converted-space">  </span>profitCnyEl.textContent = fmt(profitCny,2) + ' ¥';</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">  </span>// detailLine (многострочный)</p>
<p class="p1"><span class="Apple-converted-space">  </span>const clientRateShown = clientRateEl.value ? escHTML(clientRateEl.value) : fmt(clientRate,2);</p>
<p class="p1"><span class="Apple-converted-space">  </span>if (direction === 'rub2cny'){</p>
<p class="p1"><span class="Apple-converted-space">    </span>detailLine.innerHTML =</p>
<p class="p1"><span class="Apple-converted-space">      </span>`您好，今天的汇率: ${clientRateShown}\n` +</p>
<p class="p1"><span class="Apple-converted-space">      </span>`支付金额: ${fmt(amountRub,0)} ₽.\n` +</p>
<p class="p1"><span class="Apple-converted-space">      </span>`兑换金额: ${fmt(amountCny,2)} ¥.\n` +</p>
<p class="p1"><span class="Apple-converted-space">      </span>`联系方式: +7 (912) 891-58-82`;</p>
<p class="p1"><span class="Apple-converted-space">  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">    </span>detailLine.innerHTML =</p>
<p class="p1"><span class="Apple-converted-space">      </span>`您好，今天的汇率: ${clientRateShown}\n` +</p>
<p class="p1"><span class="Apple-converted-space">      </span>`支付金额: ${fmt(amountCny,2)} ¥.`;</p>
<p class="p1"><span class="Apple-converted-space">      </span>`兑换金额: ${fmt(amountRub,2)} ₽.\n` +</p>
<p class="p1"><span class="Apple-converted-space">  </span>}</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/* ====== Debounce ====== */</p>
<p class="p1">function scheduleRecalc(source){</p>
<p class="p1"><span class="Apple-converted-space">  </span>lastEdited = source;</p>
<p class="p1"><span class="Apple-converted-space">  </span>clearTimeout(debounceTimer);</p>
<p class="p1"><span class="Apple-converted-space">  </span>debounceTimer = setTimeout(()=&gt;{ computeAll(); lastEdited = null; }, 120);</p>
<p class="p1">}</p>
<p class="p2"><br></p>
<p class="p1">/* ====== Events ====== */</p>
<p class="p1">myRateEl.addEventListener('input', ()=&gt; scheduleRecalc('myRate'));</p>
<p class="p1">clientRateEl.addEventListener('input', ()=&gt; scheduleRecalc('clientRate'));</p>
<p class="p2"><br></p>
<p class="p1">// Обработчики для новых полей ввода</p>
<p class="p1">clientGiveEl.addEventListener('input', ()=&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>// Форматируем ввод в реальном времени</p>
<p class="p1"><span class="Apple-converted-space">  </span>const value = clientGiveEl.value.replace(/[^\d,.]/g, '');</p>
<p class="p1"><span class="Apple-converted-space">  </span>clientGiveEl.value = value;</p>
<p class="p1"><span class="Apple-converted-space">  </span>scheduleRecalc('clientGive');</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">clientGetEl.addEventListener('input', ()=&gt; {</p>
<p class="p1"><span class="Apple-converted-space">  </span>const value = clientGetEl.value.replace(/[^\d,.]/g, '');</p>
<p class="p1"><span class="Apple-converted-space">  </span>clientGetEl.value = value;</p>
<p class="p1"><span class="Apple-converted-space">  </span>scheduleRecalc('clientGet');</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">// Обработчики фокуса</p>
<p class="p1">[clientGetEl, clientGiveEl, myRateEl, clientRateEl].forEach(node=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">  </span>node.addEventListener('focus', ()=&gt;{</p>
<p class="p1"><span class="Apple-converted-space">    </span>if (node === clientGetEl) lastEdited = 'clientGet';</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (node === clientGiveEl) lastEdited = 'clientGive';</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (node === myRateEl) lastEdited = 'myRate';</p>
<p class="p1"><span class="Apple-converted-space">    </span>else if (node === clientRateEl) lastEdited = 'clientRate';</p>
<p class="p1"><span class="Apple-converted-space">  </span>});</p>
<p class="p1">});</p>
<p class="p2"><br></p>
<p class="p1">// Инициализация - очищаем все поля</p>
<p class="p1">myRateEl.value = '';</p>
<p class="p1">clientRateEl.value = '';</p>
<p class="p1">clientGiveEl.value = '';</p>
<p class="p1">clientGetEl.value = '';</p>
<p class="p1">profitRubEl.textContent = '—';</p>
<p class="p1">profitCnyEl.textContent = '—';</p>
<p class="p1">detailLine.textContent = '输入数据计算';</p>
<p class="p2"><br></p>
<p class="p1">// Устанавливаем правильные символы валют при загрузке</p>
<p class="p1">setDirection(direction);</p>
<p class="p2"><br></p>
<p class="p1">/* expose for debugging */</p>
<p class="p1">window.__calc = {computeAll, setDirection};</p>
<p class="p1">&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
